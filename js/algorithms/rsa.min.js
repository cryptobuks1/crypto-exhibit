/*!
 * Crypto Exhibit v1.0.0-alpha (http://www.crypto-exhib.it)
 * Copyright 2019 Mannheim University of Applied Sciences, Kristian Kraljic
 * Licensed under GPL-3.0-or-later
 */
var forge=require("node-forge"),BigInteger=forge.jsbn.BigInteger;exports.name="rsa",exports.displayName="RSA (Rivest, Shamir and Adleman)",exports.group="Asymmetric Cryptography",exports.parameters=[{name:"p",label:"Primefactor P",type:"number",value:"cryptoExhibit.util.randomPrime(32)",placeholder:"TODO"},{name:"q",label:"Primefactor Q",type:"number",value:"cryptoExhibit.util.randomPrime(32)",placeholder:"TODO"},{name:"e",label:"Exponent E",type:"number",value:"cryptoExhibit.algorithms.rsa.randomE(tab)",placeholder:"TODO"}],exports.input=exports.output="dec",exports.randomE=function(a){return jQuery.Deferred(function(o){!function e(){var r=jQuery.parameter(a,"rsa","p").val(),t=jQuery.parameter(a,"rsa","q").val();if(r&&t){(r=new BigInteger(r)).multiply(t=new BigInteger(t));for(var n,i=r.subtract(BigInteger.ONE).multiply(t.subtract(BigInteger.ONE));0<=(n=new BigInteger(i.bitLength(),{nextBytes:function(e){for(var r=forge.random.getBytesSync(e.length),t=0;t<e.length;t++)e[t]=r.charCodeAt(t)}})).compareTo(i)||!n.isProbablePrime(););o.resolve(n.toString())}else setTimeout(e,50)}()}).promise()},exports.encrypt=function(e,r){var t=new BigInteger(r.p).multiply(new BigInteger(r.q));return new BigInteger(e).modPow(new BigInteger(r.e),t).toString()},exports.decrypt=function(e,r){var t=new BigInteger(r.p).multiply(new BigInteger(r.q)),n=new BigInteger(r.p).subtract(BigInteger.ONE).multiply(new BigInteger(r.q).subtract(BigInteger.ONE)),i=new BigInteger(r.e).modInverse(n);return new BigInteger(e).modPow(i,t).toString()};